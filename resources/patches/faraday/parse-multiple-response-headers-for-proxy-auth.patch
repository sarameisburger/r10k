commit a5afc457f0829929f4fb7272a86d2ab085f12371
Author: Andrew Roetker <andrew.roetker@puppetlabs.com>
Date:   Tue Apr 4 14:41:26 2017 -0700

    Update parse util to understand header from multiple responses

diff --git a/lib/faraday/utils.rb b/lib/faraday/utils.rb
index 1d01e9d..a99ceb9 100644
--- a/lib/faraday/utils.rb
+++ b/lib/faraday/utils.rb
@@ -95,7 +95,13 @@ module Faraday
 
       def parse(header_string)
         return unless header_string && !header_string.empty?
-        header_string.split(/\r\n/).
+
+        headers = header_string.split(/\r\n/)
+
+        # Break headers into distinct responses, and only consider the last response.
+        last_response = headers.slice_before(/^HTTP\//).to_a.last
+
+        last_response.
           tap  { |a| a.shift if a.first.index('HTTP/') == 0 }. # drop the HTTP status line
           map  { |h| h.split(/:\s+/, 2) }.reject { |p| p[0].nil? }. # split key and value, ignore blank lines
           each { |key, value|
